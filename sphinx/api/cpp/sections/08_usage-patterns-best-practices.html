<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>8. Usage Patterns &amp; Best Practices - duvc-ctl v2.0.0 Documentation</title><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="9. Build System &amp; Integration" href="09_build-system-integration.html" /><link rel="prev" title="7. Property Reference &amp; Details" href="07_property-reference-details.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=43bd62f4" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=14737038" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="8. Usage Patterns &amp; Best Practices"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../index.html">
      
      
      <strong>duvc-ctl</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/allanhanan/duvc-ctl" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/migration.html">Migration</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../c/index.html">duvc-ctl C API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">duvc-ctl C++ API Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_overview-getting-started.html">1. Overview &amp; Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_core-api-public-headers.html">2. Core API - Public Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_utility-functions-helpers.html">3. Utility Functions &amp; Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_platform-abstraction-layer.html">4. Platform Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_vendor-specific-extensions.html">5. Vendor-Specific Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_internal-implementation-details.html">6. Internal Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_property-reference-details.html">7. Property Reference &amp; Details</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Usage Patterns &amp; Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_build-system-integration.html">9. Build System &amp; Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_platform-specific-information.html">10. Platform-Specific Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_device-support-compatibility.html">11. Device Support &amp; Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_troubleshooting-debugging.html">12. Troubleshooting &amp; Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_examples-tutorials.html">13. Examples &amp; Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_contributing-extending.html">14. Contributing &amp; Extending</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_faq.html">15. FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_appendices.html">16. Appendices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cli/index.html">duvc-ctl CLI Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">duvc-ctl Python Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/01_quick-start-installation.html">1. Quick Start &amp; Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/02_architecture-design-overview.html">2. Architecture &amp; Design Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/03_pythonic-api-cameracontroller-class.html">3. Pythonic API - CameraController Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/04_result-based-api-explicit-error-handling.html">4. Result-Based API - Explicit Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/05_comprehensive-type-reference.html">5. Comprehensive Type Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/06_enumeration-constant-reference.html">6. Enumeration &amp; Constant Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/07_exception-hierarchy-handling.html">7. Exception Hierarchy &amp; Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/08_convenience-functions-helpers.html">8. Convenience Functions &amp; Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/09_logging-diagnostics-callbacks.html">9. Logging, Diagnostics &amp; Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/10_vendor-specific-extensions.html">10. Vendor-Specific Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/11_building-contributing-pybind11-integration.html">11. Building, Contributing &amp; pybind11 Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/12_complete-property-reference-details.html">12. Complete Property Reference &amp; Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/13_common-patterns-recipes.html">13. Common Patterns &amp; Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/14_troubleshooting-faqs.html">14. Troubleshooting &amp; FAQs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/15_advanced-architecture-special-methods.html">15. Advanced Architecture &amp; Special Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/16_architecture-decision-records.html">16. Architecture Decision Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/sections/17_tutorials-getting-started.html">17. Tutorials &amp; Getting Started</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/cpp-examples.html">C++ Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/python-examples.html">Python Examples</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3></div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">duvc-ctl</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">duvc-ctl C++ API Documentation</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">8. Usage Patterns &amp; Best Practices</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="usage-patterns-best-practices">
<h1>8. Usage Patterns &amp; Best Practices<a class="headerlink" href="#usage-patterns-best-practices" title="Link to this heading">¶</a></h1>
<section id="basic-usage-patterns">
<h2>8.1 Basic Usage Patterns<a class="headerlink" href="#basic-usage-patterns" title="Link to this heading">¶</a></h2>
<p><strong>Header:</strong> <code class="docutils literal notranslate"><span class="pre">&lt;duvc-ctl/duvc.hpp&gt;</span></code>
<strong>Namespace:</strong> <code class="docutils literal notranslate"><span class="pre">duvc</span></code></p>
<p>All library functionality is accessed through a single umbrella header providing both RAII-style and quick API patterns.</p>
<hr class="docutils" />
<section id="pattern-1-device-enumeration">
<h3>Pattern 1: Device Enumeration<a class="headerlink" href="#pattern-1-device-enumeration" title="Link to this heading">¶</a></h3>
<p><strong>List all connected cameras:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/duvc.hpp&gt;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">devices</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="7"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;    &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">devices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="8"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Output example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"> Logitech BRIO
</span><span data-line="2">    \\?\usb#vid_046d&amp;pid_085e#...
</span><span data-line="3"> Integrated Webcam
</span><span data-line="4">    \\?\usb#vid_0bda&amp;pid_58c2#...
</span></pre></div>
</div>
<p><strong>Returns:</strong> <code class="docutils literal notranslate"><span class="pre">std::vector&lt;Device&gt;</span></code>
<strong>Device struct:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: Friendly device name (e.g., “Logitech C920”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: Unique system path (DirectShow device path on Windows)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>: Ordinal index in enumeration (matches vector position)</p></li>
</ul>
<p><strong>Empty list:</strong> No cameras connected or DirectShow enumeration failed.</p>
</section>
<hr class="docutils" />
<section id="pattern-2-open-camera-by-index">
<h3>Pattern 2: Open Camera by Index<a class="headerlink" href="#pattern-2-open-camera-by-index" title="Link to this heading">¶</a></h3>
<p><strong>Method 1: Direct construction</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Open first camera</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">camera</span><span class="p">.</span><span class="n">is_valid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera not available</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="5"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="6"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Method 2: Result-based (recommended)</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">open_camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="5"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="6"><span class="p">}</span>
</span><span data-line="7">
</span><span data-line="8"><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span></pre></div>
</div>
<p><strong>Difference:</strong> Direct construction throws no exception on failure; <code class="docutils literal notranslate"><span class="pre">is_valid()</span></code> checks connection state. <code class="docutils literal notranslate"><span class="pre">open_camera()</span></code> returns detailed error codes via <code class="docutils literal notranslate"><span class="pre">Result&lt;Camera&gt;</span></code>.</p>
</section>
<hr class="docutils" />
<section id="pattern-3-get-property-value">
<h3>Pattern 3: Get Property Value<a class="headerlink" href="#pattern-3-get-property-value" title="Link to this heading">¶</a></h3>
<p><strong>Read current exposure setting:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setting</span><span class="p">.</span><span class="n">value</span><span class="w"> </span>
</span><span data-line="8"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">setting</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;manual&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="9"><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="11"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Output example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Exposure</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span> <span class="p">(</span><span class="n">manual</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Returns:</strong> <code class="docutils literal notranslate"><span class="pre">Result&lt;PropSetting&gt;</span></code>
<strong>PropSetting:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>: Current property value (device-specific scale)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: <code class="docutils literal notranslate"><span class="pre">CamMode::Auto</span></code> or <code class="docutils literal notranslate"><span class="pre">CamMode::Manual</span></code></p></li>
</ul>
<p><strong>Common errors:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode::NotSupported</span></code>: Property not implemented by hardware</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode::DeviceNotFound</span></code>: Camera disconnected</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pattern-4-set-property-value">
<h3>Pattern 4: Set Property Value<a class="headerlink" href="#pattern-4-set-property-value" title="Link to this heading">¶</a></h3>
<p><strong>Set brightness to fixed value:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="p">{</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">};</span><span class="w">  </span><span class="c1">// brightness=30, manual mode</span>
</span><span data-line="4"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="n">setting</span><span class="p">);</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Brightness set to 30</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="8"><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="10"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Enable auto-exposure:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">PropSetting</span><span class="w"> </span><span class="n">auto_setting</span><span class="p">{</span><span class="n">range</span><span class="p">.</span><span class="n">default_val</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="p">};</span>
</span><span data-line="4"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">auto_setting</span><span class="p">);</span>
</span></pre></div>
</div>
<p><strong>Returns:</strong> <code class="docutils literal notranslate"><span class="pre">Result&lt;void&gt;</span></code>
<strong>Best practice:</strong> Always query <code class="docutils literal notranslate"><span class="pre">get_range()</span></code> before setting to ensure value is within valid bounds.</p>
</section>
<hr class="docutils" />
<section id="pattern-5-query-property-range">
<h3>Pattern 5: Query Property Range<a class="headerlink" href="#pattern-5-query-property-range" title="Link to this heading">¶</a></h3>
<p><strong>Check valid exposure values:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure range: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; to &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="8"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Step: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">step</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, default: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">default_val</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="9"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Default mode: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">default_mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;Auto&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Manual&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="10"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Output example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Exposure</span> <span class="nb">range</span><span class="p">:</span> <span class="o">-</span><span class="mi">13</span> <span class="n">to</span> <span class="o">-</span><span class="mi">1</span>
</span><span data-line="2"><span class="n">Step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span>
</span><span data-line="3"><span class="n">Default</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Auto</span>
</span></pre></div>
</div>
<p><strong>Use case:</strong> Validating user input before calling <code class="docutils literal notranslate"><span class="pre">set()</span></code> to prevent out-of-range errors.</p>
</section>
<hr class="docutils" />
<section id="pattern-6-safe-value-clamping">
<h3>Pattern 6: Safe Value Clamping<a class="headerlink" href="#pattern-6-safe-value-clamping" title="Link to this heading">¶</a></h3>
<p><strong>Handle arbitrary user input:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="3">
</span><span data-line="4"><span class="kt">int</span><span class="w"> </span><span class="n">user_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150</span><span class="p">;</span><span class="w">  </span><span class="c1">// Potentially invalid</span>
</span><span data-line="5"><span class="kt">int</span><span class="w"> </span><span class="n">safe_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">user_input</span><span class="p">);</span><span class="w">  </span><span class="c1">// Constrain to [min, max]</span>
</span><span data-line="6">
</span><span data-line="7"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">safe_value</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Behavior:</strong></p>
<ul class="simple">
<li><p>Clamps <code class="docutils literal notranslate"><span class="pre">user_input</span></code> to <code class="docutils literal notranslate"><span class="pre">[range.min,</span> <span class="pre">range.max]</span></code></p></li>
<li><p>Rounds to nearest <code class="docutils literal notranslate"><span class="pre">range.step</span></code> boundary</p></li>
<li><p>Always returns valid value accepted by hardware</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pattern-7-quick-api-no-result-handling">
<h3>Pattern 7: Quick API (No Result Handling)<a class="headerlink" href="#pattern-7-quick-api-no-result-handling" title="Link to this heading">¶</a></h3>
<p><strong>Simplified one-shot operations:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/duvc.hpp&gt;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="4"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">devices</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="p">;</span>
</span><span data-line="7"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">duvc</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span><span class="w"> </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">setting</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="8"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setting</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="9"><span class="p">}</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">};</span>
</span><span data-line="12"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">duvc</span><span class="o">::</span><span class="n">set</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span><span class="w"> </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">setting</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="13"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure set</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="14"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Returns:</strong> <code class="docutils literal notranslate"><span class="pre">bool</span></code> (true = success, false = failure)
<strong>Use case:</strong> CLI tools, scripts, throwaway code where detailed error messages aren’t needed.</p>
<p><strong>Limitations:</strong> No error code access; failures are silent.</p>
</section>
<hr class="docutils" />
<section id="pattern-8-enumerate-all-capabilities">
<h3>Pattern 8: Enumerate All Capabilities<a class="headerlink" href="#pattern-8-enumerate-all-capabilities" title="Link to this heading">¶</a></h3>
<p><strong>Dump all supported properties:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// Camera properties</span>
</span><span data-line="4"><span class="k">const</span><span class="w"> </span><span class="n">CamProp</span><span class="w"> </span><span class="n">cam_props</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">    </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Pan</span><span class="p">,</span><span class="w"> </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Tilt</span><span class="p">,</span><span class="w"> </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span>
</span><span data-line="6"><span class="w">    </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Focus</span><span class="p">,</span><span class="w"> </span><span class="cm">/* ... */</span>
</span><span data-line="7"><span class="p">};</span>
</span><span data-line="8">
</span><span data-line="9"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">CamProp</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cam_props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">range_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">prop</span><span class="p">);</span>
</span><span data-line="11"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w">  </span><span class="c1">// Unsupported</span>
</span><span data-line="12"><span class="w">    </span>
</span><span data-line="13"><span class="w">    </span><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range_result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="14"><span class="w">    </span><span class="n">PropSetting</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="15"><span class="w">    </span>
</span><span data-line="16"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;CamProp::&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="cm">/* property name */</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="17"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  Range: [&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="18"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  Current: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">current</span><span class="p">.</span><span class="n">value</span><span class="w"> </span>
</span><span data-line="19"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;manual&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="20"><span class="p">}</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1">// Video properties</span>
</span><span data-line="23"><span class="k">const</span><span class="w"> </span><span class="n">VidProp</span><span class="w"> </span><span class="n">vid_props</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="24"><span class="w">    </span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="n">VidProp</span><span class="o">::</span><span class="n">Contrast</span><span class="p">,</span><span class="w"> </span><span class="cm">/* ... */</span>
</span><span data-line="25"><span class="p">};</span>
</span><span data-line="26">
</span><span data-line="27"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">VidProp</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">vid_props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="28"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">range_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">prop</span><span class="p">);</span>
</span><span data-line="29"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span data-line="30"><span class="w">    </span>
</span><span data-line="31"><span class="w">    </span><span class="c1">// Same logic as camera properties</span>
</span><span data-line="32"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Use case:</strong> Configuration UI, capability discovery, debugging hardware support.</p>
</section>
<hr class="docutils" />
<section id="pattern-9-raii-resource-management">
<h3>Pattern 9: RAII Resource Management<a class="headerlink" href="#pattern-9-raii-resource-management" title="Link to this heading">¶</a></h3>
<p><strong>Automatic cleanup:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Opens DirectShow connection</span>
</span><span data-line="3"><span class="w">    </span>
</span><span data-line="4"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="5"><span class="w">    </span><span class="c1">// ... use camera ...</span>
</span><span data-line="6"><span class="w">    </span>
</span><span data-line="7"><span class="p">}</span><span class="w">  </span><span class="c1">// Camera destructor releases DirectShow interfaces automatically</span>
</span></pre></div>
</div>
<p><strong>Move semantics:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">create_camera</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Camera</span><span class="p">(</span><span class="n">index</span><span class="p">);</span><span class="w">  </span><span class="c1">// Move construction</span>
</span><span data-line="3"><span class="p">}</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">Camera</span><span class="w"> </span><span class="n">cam1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="6"><span class="n">Camera</span><span class="w"> </span><span class="n">cam2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">cam1</span><span class="p">);</span><span class="w">  </span><span class="c1">// cam1 is now invalid</span>
</span></pre></div>
</div>
<p><strong>Non-copyable:</strong> <code class="docutils literal notranslate"><span class="pre">Camera</span></code> cannot be copied (prevents accidental double-release of COM interfaces).</p>
</section>
<hr class="docutils" />
<section id="pattern-10-error-handling-strategies">
<h3>Pattern 10: Error Handling Strategies<a class="headerlink" href="#pattern-10-error-handling-strategies" title="Link to this heading">¶</a></h3>
<p><strong>Strategy 1: Check every result</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">get_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="2"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">get_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="n">handle_error</span><span class="p">(</span><span class="n">get_result</span><span class="p">.</span><span class="n">error</span><span class="p">());</span>
</span><span data-line="4"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="5"><span class="p">}</span>
</span><span data-line="6"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span></pre></div>
</div>
<p><strong>Strategy 2: Chain with early return</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">);</span>
</span><span data-line="2"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w">  </span><span class="c1">// Result converts to bool</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">range</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">max</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Strategy 3: Quick API for non-critical operations</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">PropSetting</span><span class="w"> </span><span class="n">brightness</span><span class="p">;</span>
</span><span data-line="2"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">duvc</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="n">brightness</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="c1">// Use brightness...</span>
</span><span data-line="4"><span class="p">}</span>
</span><span data-line="5"><span class="c1">// Failure is silently ignored</span>
</span></pre></div>
</div>
<p><strong>Best practice:</strong> Use full <code class="docutils literal notranslate"><span class="pre">Result</span></code> API for application-critical operations; quick API for optional features.</p>
</section>
</section>
<section id="advanced-patterns">
<h2>8.2 Advanced Patterns<a class="headerlink" href="#advanced-patterns" title="Link to this heading">¶</a></h2>
<p><strong>Header:</strong> <code class="docutils literal notranslate"><span class="pre">&lt;duvc-ctl/duvc.hpp&gt;</span></code></p>
<p>Advanced use cases for multi-camera systems, hot-plug handling, and vendor-specific extensions.</p>
<hr class="docutils" />
<section id="pattern-1-multi-camera-management">
<h3>Pattern 1: Multi-Camera Management<a class="headerlink" href="#pattern-1-multi-camera-management" title="Link to this heading">¶</a></h3>
<p><strong>Control multiple cameras simultaneously:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/duvc.hpp&gt;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="4"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Camera</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cameras</span><span class="p">;</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1">// Open all cameras</span>
</span><span data-line="7"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="8"><span class="w">    </span><span class="n">cameras</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</span><span data-line="9"><span class="p">}</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1">// Configure all cameras identically</span>
</span><span data-line="12"><span class="n">PropSetting</span><span class="w"> </span><span class="n">exposure</span><span class="p">{</span><span class="mi">-7</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">};</span>
</span><span data-line="13"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cameras</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="14"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">exposure</span><span class="p">);</span>
</span><span data-line="15"><span class="p">}</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1">// Read from specific camera</span>
</span><span data-line="18"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameras</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="19"><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera 0 exposure: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setting</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span></pre></div>
</div>
<p><strong>Per-camera configuration:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Camera 0: high exposure for dark scene</span>
</span><span data-line="2"><span class="n">cameras</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-3</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// Camera 1: low exposure for bright scene</span>
</span><span data-line="5"><span class="n">cameras</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-10</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// Camera 2: auto-exposure</span>
</span><span data-line="8"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameras</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="9"><span class="n">cameras</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">range</span><span class="p">.</span><span class="n">default_val</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Thread-safe access:</strong> <code class="docutils literal notranslate"><span class="pre">Camera</span></code> objects are <strong>not</strong> thread-safe. Each camera should be accessed from a single thread, or protected by mutex.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">camera_mutexes</span><span class="p">;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">worker1</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">camera_mutexes</span><span class="p">);</span>
</span><span data-line="5"><span class="w">    </span><span class="n">cameras</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="6"><span class="p">});</span>
</span><span data-line="7">
</span><span data-line="8"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">worker2</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">camera_mutexes</span><span class="p">);</span>
</span><span data-line="10"><span class="w">    </span><span class="n">cameras</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="11"><span class="p">});</span>
</span><span data-line="12">
</span><span data-line="13"><span class="n">worker1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
</span><span data-line="14"><span class="n">worker2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-2-hot-plug-detection">
<h3>Pattern 2: Hot-Plug Detection<a class="headerlink" href="#pattern-2-hot-plug-detection" title="Link to this heading">¶</a></h3>
<p><strong>Monitor device connection/disconnection events:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/duvc.hpp&gt;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="kt">void</span><span class="w"> </span><span class="nf">on_device_change</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">added</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">added</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera connected: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device_path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="6"><span class="w">        </span>
</span><span data-line="7"><span class="w">        </span><span class="c1">// Re-enumerate to get Device object</span>
</span><span data-line="8"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="9"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dev</span><span class="p">.</span><span class="n">path</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">device_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="11"><span class="w">                </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
</span><span data-line="12"><span class="w">                </span><span class="c1">// Configure newly connected camera...</span>
</span><span data-line="13"><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="14"><span class="w">            </span><span class="p">}</span>
</span><span data-line="15"><span class="w">        </span><span class="p">}</span>
</span><span data-line="16"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="17"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera disconnected: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device_path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="18"><span class="w">        </span><span class="c1">// Clean up Camera handles referencing this device</span>
</span><span data-line="19"><span class="w">    </span><span class="p">}</span>
</span><span data-line="20"><span class="p">}</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1">// Register callback</span>
</span><span data-line="23"><span class="n">duvc</span><span class="o">::</span><span class="n">register_device_change_callback</span><span class="p">(</span><span class="n">on_device_change</span><span class="p">);</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1">// Run application...</span>
</span><span data-line="26">
</span><span data-line="27"><span class="c1">// Cleanup</span>
</span><span data-line="28"><span class="n">duvc</span><span class="o">::</span><span class="n">unregister_device_change_callback</span><span class="p">();</span>
</span></pre></div>
</div>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li><p>Only <strong>one callback</strong> can be registered at a time (subsequent calls replace previous callback)</p></li>
<li><p>Callback is invoked from <strong>Windows message pump thread</strong> — keep logic minimal or dispatch to worker thread</p></li>
<li><p>Callback receives <code class="docutils literal notranslate"><span class="pre">device_path</span></code> (string), not <code class="docutils literal notranslate"><span class="pre">Device</span></code> object — must re-enumerate to match</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pattern-3-validate-device-connection">
<h3>Pattern 3: Validate Device Connection<a class="headerlink" href="#pattern-3-validate-device-connection" title="Link to this heading">¶</a></h3>
<p><strong>Check if camera is still accessible:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// ... time passes ...</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="6"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">devices</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">duvc</span><span class="o">::</span><span class="n">is_device_connected</span><span class="p">(</span><span class="n">devices</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera disconnected!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="8"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="9"><span class="p">}</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1">// Safe to use camera</span>
</span><span data-line="12"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="13"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="14"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera no longer responds</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="15"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Use case:</strong> Long-running applications that need to detect unplugged cameras before attempting operations.</p>
<p><strong>Performance:</strong> <code class="docutils literal notranslate"><span class="pre">is_device_connected()</span></code> performs lightweight DirectShow enumeration (&lt; 10ms on typical systems).</p>
</section>
<hr class="docutils" />
<section id="pattern-4-hot-plug-recovery">
<h3>Pattern 4: Hot-Plug Recovery<a class="headerlink" href="#pattern-4-hot-plug-recovery" title="Link to this heading">¶</a></h3>
<p><strong>Automatically reconnect to camera:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">CameraManager</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="k">public</span><span class="o">:</span>
</span><span data-line="3"><span class="w">    </span><span class="n">CameraManager</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">device_index</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">device_index_</span><span class="p">(</span><span class="n">device_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">        </span><span class="n">reconnect</span><span class="p">();</span>
</span><span data-line="5"><span class="w">    </span><span class="p">}</span>
</span><span data-line="6"><span class="w">    </span>
</span><span data-line="7"><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">reconnect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="8"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="9"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">device_index_</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">devices</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Device index out of range</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="11"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span data-line="12"><span class="w">        </span><span class="p">}</span>
</span><span data-line="13"><span class="w">        </span>
</span><span data-line="14"><span class="w">        </span><span class="n">camera_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Camera</span><span class="o">&gt;</span><span class="p">(</span><span class="n">devices</span><span class="p">[</span><span class="n">device_index_</span><span class="p">]);</span>
</span><span data-line="15"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">camera_</span><span class="o">-&gt;</span><span class="n">is_valid</span><span class="p">();</span>
</span><span data-line="16"><span class="w">    </span><span class="p">}</span>
</span><span data-line="17"><span class="w">    </span>
</span><span data-line="18"><span class="w">    </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">camera_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span data-line="19"><span class="w">    </span>
</span><span data-line="20"><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_connected</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="21"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="22"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">device_index_</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">devices</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
</span><span data-line="23"><span class="w">               </span><span class="n">duvc</span><span class="o">::</span><span class="n">is_device_connected</span><span class="p">(</span><span class="n">devices</span><span class="p">[</span><span class="n">device_index_</span><span class="p">]);</span>
</span><span data-line="24"><span class="w">    </span><span class="p">}</span>
</span><span data-line="25"><span class="w">    </span>
</span><span data-line="26"><span class="k">private</span><span class="o">:</span>
</span><span data-line="27"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">device_index_</span><span class="p">;</span>
</span><span data-line="28"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Camera</span><span class="o">&gt;</span><span class="w"> </span><span class="n">camera_</span><span class="p">;</span>
</span><span data-line="29"><span class="p">};</span>
</span><span data-line="30">
</span><span data-line="31"><span class="c1">// Usage</span>
</span><span data-line="32"><span class="n">CameraManager</span><span class="w"> </span><span class="nf">manager</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="33">
</span><span data-line="34"><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="35"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">manager</span><span class="p">.</span><span class="n">is_connected</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="36"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera lost, attempting reconnect...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="37"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">manager</span><span class="p">.</span><span class="n">reconnect</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="38"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Reconnected!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="39"><span class="w">        </span><span class="p">}</span>
</span><span data-line="40"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="41"><span class="w">        </span><span class="n">manager</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-6</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="42"><span class="w">    </span><span class="p">}</span>
</span><span data-line="43"><span class="w">    </span>
</span><span data-line="44"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</span><span data-line="45"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-5-logitech-vendor-extensions">
<h3>Pattern 5: Logitech Vendor Extensions<a class="headerlink" href="#pattern-5-logitech-vendor-extensions" title="Link to this heading">¶</a></h3>
<p><strong>Access Logitech-specific properties:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/duvc.hpp&gt;</span>
</span><span data-line="2"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/vendor/logitech.h&gt;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="5"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// Check Logitech support</span>
</span><span data-line="8"><span class="k">auto</span><span class="w"> </span><span class="n">support_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">supports_logitech_properties</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="9"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">support_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">support_result</span><span class="p">.</span><span class="n">value</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Not a Logitech camera or unsupported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="11"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="12"><span class="p">}</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1">// Enable RightLight (auto-exposure enhancement)</span>
</span><span data-line="15"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">set_logitech_property_typed</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span>
</span><span data-line="16"><span class="w">    </span><span class="n">devices</span><span class="p">,</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">LogitechProperty</span><span class="o">::</span><span class="n">RightLight</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span data-line="17">
</span><span data-line="18"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="19"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;RightLight enabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="20"><span class="p">}</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1">// Read LED indicator state</span>
</span><span data-line="23"><span class="k">auto</span><span class="w"> </span><span class="n">led_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">get_logitech_property_typed</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span>
</span><span data-line="24"><span class="w">    </span><span class="n">devices</span><span class="p">,</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">LogitechProperty</span><span class="o">::</span><span class="n">LedIndicator</span><span class="p">);</span>
</span><span data-line="25">
</span><span data-line="26"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">led_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="27"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;LED mode: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">led_result</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="28"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Available Logitech properties:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RightLight</span></code>: Auto-exposure and brightness optimization (0 = off, 1-3 = intensity levels)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RightSound</span></code>: Audio processing and noise cancellation (bool)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FaceTracking</span></code>: Face tracking for auto-framing (bool)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LedIndicator</span></code>: LED control (0 = off, 1 = on, 2 = blink)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ProcessorUsage</span></code>: CPU optimization hints (device-specific values)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RawDataBits</span></code>: Bit depth configuration (8/10/12)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FocusAssist</span></code>: Focus assist beam (bool)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VideoStandard</span></code>: Video standard selection (NTSC/PAL enum)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DigitalZoomROI</span></code>: Region of interest coordinates (struct with x/y/width/height)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TiltPan</span></code>: Combined tilt/pan absolute positioning (struct with tilt/pan values)</p></li>
</ul>
<p><strong>Type safety:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">- `get_logitech_property_typed&lt;T&gt;()` and `set_logitech_property_typed&lt;T&gt;()` require type `T` to be **trivially copyable** and match property&#39;s binary layout
</span></pre></div>
</div>
<ul class="simple">
<li><p>For boolean properties, use <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> (not <code class="docutils literal notranslate"><span class="pre">bool</span></code>) — DirectShow stores booleans as 4-byte integers</p></li>
<li><p>For raw byte access, use <code class="docutils literal notranslate"><span class="pre">get_logitech_property()</span></code> / <code class="docutils literal notranslate"><span class="pre">set_logitech_property()</span></code> which return <code class="docutils literal notranslate"><span class="pre">std::vector&lt;uint8_t&gt;</span></code></p></li>
</ul>
<p><strong>Error handling:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode::NotSupported</span></code>: Property not available on this camera model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode::SystemError</span></code>: DirectShow KsProperty call failed</p></li>
<li><p>Check <code class="docutils literal notranslate"><span class="pre">supports_logitech_properties()</span></code> before accessing any Logitech properties</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pattern-6-vendor-extension-detection">
<h3>Pattern 6: Vendor Extension Detection<a class="headerlink" href="#pattern-6-vendor-extension-detection" title="Link to this heading">¶</a></h3>
<p><strong>Determine if camera supports vendor properties:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="5"><span class="w">    </span>
</span><span data-line="6"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">logitech_support</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">supports_logitech_properties</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</span><span data-line="7"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">logitech_support</span><span class="p">.</span><span class="n">is_ok</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">logitech_support</span><span class="p">.</span><span class="n">value</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="8"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  - Logitech extensions available</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="9"><span class="w">        </span>
</span><span data-line="10"><span class="w">        </span><span class="c1">// Test specific property support</span>
</span><span data-line="11"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">rightlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">get_logitech_property_typed</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">(</span>
</span><span data-line="12"><span class="w">            </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">logitech</span><span class="o">::</span><span class="n">LogitechProperty</span><span class="o">::</span><span class="n">RightLight</span><span class="p">);</span>
</span><span data-line="13"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rightlight</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="14"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;    - RightLight: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rightlight</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="15"><span class="w">        </span><span class="p">}</span>
</span><span data-line="16"><span class="w">    </span><span class="p">}</span>
</span><span data-line="17"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Fallback strategy:</strong> If vendor extensions fail, use standard DirectShow properties (exposure, brightness, etc.) which work across all cameras.</p>
</section>
<hr class="docutils" />
<section id="pattern-7-low-level-directshow-access">
<h3>Pattern 7: Low-Level DirectShow Access<a class="headerlink" href="#pattern-7-low-level-directshow-access" title="Link to this heading">¶</a></h3>
<p><strong>Direct COM interface usage (advanced):</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/core/connection_pool.h&gt;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// DeviceConnection provides low-level DirectShow access</span>
</span><span data-line="4"><span class="n">duvc</span><span class="o">::</span><span class="n">DeviceConnection</span><span class="w"> </span><span class="nf">conn</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">conn</span><span class="p">.</span><span class="n">is_valid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to open connection</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="8"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="9"><span class="p">}</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1">// Efficient repeated operations without Result overhead</span>
</span><span data-line="12"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="p">;</span>
</span><span data-line="13"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">setting</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="14"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setting</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="15"><span class="p">}</span>
</span><span data-line="16">
</span><span data-line="17"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">conn</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-7</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="18"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure updated</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="19"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>When to use <code class="docutils literal notranslate"><span class="pre">DeviceConnection</span></code>:</strong></p>
<ul class="simple">
<li><p>High-frequency property polling (&gt; 100 Hz)</p></li>
<li><p>Performance-critical loops where <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code> overhead matters</p></li>
<li><p>Custom DirectShow integration requiring raw COM interfaces</p></li>
</ul>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li><p>No automatic error propagation (returns <code class="docutils literal notranslate"><span class="pre">bool</span></code>, not <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code>)</p></li>
<li><p>Requires manual connection validity checks via <code class="docutils literal notranslate"><span class="pre">is_valid()</span></code></p></li>
<li><p>Throws <code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code> on construction failure (no graceful error handling)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pattern-8-persistent-configuration">
<h3>Pattern 8: Persistent Configuration<a class="headerlink" href="#pattern-8-persistent-configuration" title="Link to this heading">¶</a></h3>
<p><strong>Save and restore camera settings:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">struct</span><span class="w"> </span><span class="nc">CameraConfig</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">exposure</span><span class="p">;</span>
</span><span data-line="3"><span class="w">    </span><span class="n">CamMode</span><span class="w"> </span><span class="n">exposure_mode</span><span class="p">;</span>
</span><span data-line="4"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">brightness</span><span class="p">;</span>
</span><span data-line="5"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">contrast</span><span class="p">;</span>
</span><span data-line="6"><span class="w">    </span><span class="c1">// ... other properties</span>
</span><span data-line="7"><span class="p">};</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1">// Save</span>
</span><span data-line="10"><span class="n">CameraConfig</span><span class="w"> </span><span class="nf">save_config</span><span class="p">(</span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="11"><span class="w">    </span><span class="n">CameraConfig</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
</span><span data-line="12"><span class="w">    </span>
</span><span data-line="13"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">exp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="14"><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">exposure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span><span data-line="15"><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">exposure_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">.</span><span class="n">mode</span><span class="p">;</span>
</span><span data-line="16"><span class="w">    </span>
</span><span data-line="17"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">bright</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="18"><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">brightness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bright</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span><span data-line="19"><span class="w">    </span>
</span><span data-line="20"><span class="w">    </span><span class="c1">// ... save other properties</span>
</span><span data-line="21"><span class="w">    </span>
</span><span data-line="22"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
</span><span data-line="23"><span class="p">}</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1">// Restore</span>
</span><span data-line="26"><span class="kt">void</span><span class="w"> </span><span class="nf">restore_config</span><span class="p">(</span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">CameraConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="27"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">config</span><span class="p">.</span><span class="n">exposure</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">exposure_mode</span><span class="p">});</span>
</span><span data-line="28"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">config</span><span class="p">.</span><span class="n">brightness</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="29"><span class="w">    </span><span class="c1">// ... restore other properties</span>
</span><span data-line="30"><span class="p">}</span>
</span><span data-line="31">
</span><span data-line="32"><span class="c1">// Serialize to JSON/file</span>
</span><span data-line="33"><span class="kt">void</span><span class="w"> </span><span class="nf">save_to_file</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">CameraConfig</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="34"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
</span><span data-line="35"><span class="w">    </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;exposure=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">exposure</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="36"><span class="w">         </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;exposure_mode=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">exposure_mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;manual&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="37"><span class="w">         </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;brightness=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">brightness</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="38"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Hardware reset behavior:</strong> Some cameras reset all properties to defaults on power cycle or USB reconnect. Always restore configuration after hot-plug events.</p>
</section>
<hr class="docutils" />
<section id="pattern-9-capability-driven-ui">
<h3>Pattern 9: Capability-Driven UI<a class="headerlink" href="#pattern-9-capability-driven-ui" title="Link to this heading">¶</a></h3>
<p><strong>Generate UI controls based on device capabilities:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// Enumerate supported properties</span>
</span><span data-line="4"><span class="k">struct</span><span class="w"> </span><span class="nc">PropertyInfo</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span data-line="6"><span class="w">    </span><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="p">;</span>
</span><span data-line="7"><span class="w">    </span><span class="n">PropSetting</span><span class="w"> </span><span class="n">current</span><span class="p">;</span>
</span><span data-line="8"><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">auto_capable</span><span class="p">;</span>
</span><span data-line="9"><span class="p">};</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PropertyInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">enumerate_properties</span><span class="p">(</span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="12"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PropertyInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">properties</span><span class="p">;</span>
</span><span data-line="13"><span class="w">    </span>
</span><span data-line="14"><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">CamProp</span><span class="w"> </span><span class="n">cam_props</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">CamProp</span><span class="o">::</span><span class="n">Focus</span><span class="p">,</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">};</span>
</span><span data-line="15"><span class="w">    </span>
</span><span data-line="16"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">CamProp</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cam_props</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="17"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">range_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">prop</span><span class="p">);</span>
</span><span data-line="18"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w">  </span><span class="c1">// Unsupported</span>
</span><span data-line="19"><span class="w">        </span>
</span><span data-line="20"><span class="w">        </span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">info</span><span class="p">;</span>
</span><span data-line="21"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* property name string */</span><span class="p">;</span>
</span><span data-line="22"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range_result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="23"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="24"><span class="w">        </span><span class="n">info</span><span class="p">.</span><span class="n">auto_capable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">range</span><span class="p">.</span><span class="n">default_mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="p">);</span>
</span><span data-line="25"><span class="w">        </span>
</span><span data-line="26"><span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
</span><span data-line="27"><span class="w">    </span><span class="p">}</span>
</span><span data-line="28"><span class="w">    </span>
</span><span data-line="29"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">properties</span><span class="p">;</span>
</span><span data-line="30"><span class="p">}</span>
</span><span data-line="31">
</span><span data-line="32"><span class="c1">// Use in Qt/wxWidgets/etc</span>
</span><span data-line="33"><span class="kt">void</span><span class="w"> </span><span class="n">create_ui</span><span class="p">(</span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="34"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">enumerate_properties</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span><span data-line="35"><span class="w">    </span>
</span><span data-line="36"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="37"><span class="w">        </span><span class="c1">// Create slider with range [prop.range.min, prop.range.max]</span>
</span><span data-line="38"><span class="w">        </span><span class="c1">// Set slider value to prop.current.value</span>
</span><span data-line="39"><span class="w">        </span><span class="c1">// Add auto checkbox if prop.auto_capable</span>
</span><span data-line="40"><span class="w">    </span><span class="p">}</span>
</span><span data-line="41"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Use case:</strong> Configuration tools, camera test utilities, OBS Studio plugins.</p>
</section>
<hr class="docutils" />
<section id="pattern-10-error-recovery-strategies">
<h3>Pattern 10: Error Recovery Strategies<a class="headerlink" href="#pattern-10-error-recovery-strategies" title="Link to this heading">¶</a></h3>
<p><strong>Handle transient DirectShow failures:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Func</span><span class="o">&gt;</span>
</span><span data-line="2"><span class="k">auto</span><span class="w"> </span><span class="n">retry_on_failure</span><span class="p">(</span><span class="n">Func</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_attempts</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">attempt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">();</span>
</span><span data-line="5"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span data-line="7"><span class="w">        </span><span class="p">}</span>
</span><span data-line="8"><span class="w">        </span>
</span><span data-line="9"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">DeviceNotFound</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">  </span><span class="c1">// Don&#39;t retry, camera is gone</span>
</span><span data-line="11"><span class="w">        </span><span class="p">}</span>
</span><span data-line="12"><span class="w">        </span>
</span><span data-line="13"><span class="w">        </span><span class="c1">// Retry on transient errors</span>
</span><span data-line="14"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">50</span><span class="p">));</span>
</span><span data-line="15"><span class="w">    </span><span class="p">}</span>
</span><span data-line="16"><span class="w">    </span>
</span><span data-line="17"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">func</span><span class="p">();</span><span class="w">  </span><span class="c1">// Final attempt</span>
</span><span data-line="18"><span class="p">}</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1">// Usage</span>
</span><span data-line="21"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retry_on_failure</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="22"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-7</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="23"><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Common transient errors:</strong> DirectShow occasionally returns <code class="docutils literal notranslate"><span class="pre">E_FAIL</span></code> or <code class="docutils literal notranslate"><span class="pre">HRESULT</span></code> errors on first access after device re-enumeration. Retrying typically succeeds.</p>
</section>
</section>
<section id="error-handling-strategies">
<h2>8.3 Error Handling Strategies<a class="headerlink" href="#error-handling-strategies" title="Link to this heading">¶</a></h2>
<p><strong>Header:</strong> <code class="docutils literal notranslate"><span class="pre">&lt;duvc-ctl/core/result.h&gt;</span></code></p>
<p>Comprehensive error handling using <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code> type and <code class="docutils literal notranslate"><span class="pre">ErrorCode</span></code> enum.</p>
<hr class="docutils" />
<section id="error-code-reference">
<h3>Error Code Reference<a class="headerlink" href="#error-code-reference" title="Link to this heading">¶</a></h3>
<p><strong>Enum:</strong> <code class="docutils literal notranslate"><span class="pre">ErrorCode</span></code></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Error Code</p></th>
<th class="head text-left"><p>Description</p></th>
<th class="head text-left"><p>Common Causes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Success</span></code></p></td>
<td class="text-left"><p>Operation succeeded</p></td>
<td class="text-left"><p>(not returned in <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code>)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">DeviceNotFound</span></code></p></td>
<td class="text-left"><p>Camera disconnected or not enumerated</p></td>
<td class="text-left"><p>USB unplug, driver failure</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">DeviceBusy</span></code></p></td>
<td class="text-left"><p>Camera in use by another application</p></td>
<td class="text-left"><p>OBS Studio, Skype, Teams active</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">PropertyNotSupported</span></code></p></td>
<td class="text-left"><p>Property not implemented by hardware</p></td>
<td class="text-left"><p>Unsupported <code class="docutils literal notranslate"><span class="pre">CamProp</span></code>/<code class="docutils literal notranslate"><span class="pre">VidProp</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">InvalidValue</span></code></p></td>
<td class="text-left"><p>Value outside valid range</p></td>
<td class="text-left"><p>Out-of-bounds property value</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">PermissionDenied</span></code></p></td>
<td class="text-left"><p>Insufficient access rights</p></td>
<td class="text-left"><p>Admin privileges required</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">SystemError</span></code></p></td>
<td class="text-left"><p>DirectShow/COM failure</p></td>
<td class="text-left"><p>Driver crash, HRESULT error</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">InvalidArgument</span></code></p></td>
<td class="text-left"><p>Invalid function parameter</p></td>
<td class="text-left"><p>Null pointer, invalid index</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code></p></td>
<td class="text-left"><p>Feature unavailable on platform</p></td>
<td class="text-left"><p>Non-Windows platform</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Convert to string:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">error_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">DeviceNotFound</span><span class="p">);</span>
</span><span data-line="2"><span class="c1">// Returns: &quot;Device not found or disconnected&quot;</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="result-type-api">
<h3>Result Type API<a class="headerlink" href="#result-type-api" title="Link to this heading">¶</a></h3>
<p><strong>Template:</strong> <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">Result</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="k">public</span><span class="o">:</span>
</span><span data-line="4"><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_ok</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">        </span><span class="c1">// true if contains value</span>
</span><span data-line="5"><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">is_error</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">     </span><span class="c1">// true if contains error</span>
</span><span data-line="6"><span class="w">    </span>
</span><span data-line="7"><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">value</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Get value (throws if error)</span>
</span><span data-line="8"><span class="w">    </span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">value</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">;</span><span class="w">            </span><span class="c1">// Move value (throws if error)</span>
</span><span data-line="9"><span class="w">    </span>
</span><span data-line="10"><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Error</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">error</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="c1">// Get error (throws if success)</span>
</span><span data-line="11"><span class="w">    </span>
</span><span data-line="12"><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="nf">value_or</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">default_value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// Get value or default</span>
</span><span data-line="13"><span class="w">    </span>
</span><span data-line="14"><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="kt">bool</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// Implicit bool conversion</span>
</span><span data-line="15"><span class="p">};</span>
</span></pre></div>
</div>
<p><strong>Specialization for void:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Result</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="w"> </span><span class="n">prop</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">PropSetting</span><span class="o">&amp;</span><span class="w"> </span><span class="n">setting</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// No value() method, only is_ok()/is_error()</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-1-basic-error-checking">
<h3>Pattern 1: Basic Error Checking<a class="headerlink" href="#pattern-1-basic-error-checking" title="Link to this heading">¶</a></h3>
<p><strong>Check success before accessing value:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="5"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setting</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="6"><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="8"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Boolean conversion:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Equivalent to result.is_ok()</span>
</span><span data-line="2"><span class="w">    </span><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="3"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-2-error-code-inspection">
<h3>Pattern 2: Error Code Inspection<a class="headerlink" href="#pattern-2-error-code-inspection" title="Link to this heading">¶</a></h3>
<p><strong>Handle specific error types:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ErrorCode</span><span class="o">::</span><span class="no">DeviceNotFound</span><span class="p">:</span>
</span><span data-line="6"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera disconnected - reconnecting...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="7"><span class="w">            </span><span class="c1">// Attempt reconnection</span>
</span><span data-line="8"><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="9"><span class="w">        </span>
</span><span data-line="10"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ErrorCode</span><span class="o">::</span><span class="no">PropertyNotSupported</span><span class="p">:</span>
</span><span data-line="11"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure not supported, falling back to brightness</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="12"><span class="w">            </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="13"><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="14"><span class="w">        </span>
</span><span data-line="15"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ErrorCode</span><span class="o">::</span><span class="no">InvalidValue</span><span class="p">:</span>
</span><span data-line="16"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Value out of range</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="17"><span class="w">            </span><span class="c1">// Query range and retry</span>
</span><span data-line="18"><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="19"><span class="w">        </span>
</span><span data-line="20"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">ErrorCode</span><span class="o">::</span><span class="no">DeviceBusy</span><span class="p">:</span>
</span><span data-line="21"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera in use by another application</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="22"><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="23"><span class="w">        </span>
</span><span data-line="24"><span class="w">        </span><span class="k">default</span><span class="o">:</span>
</span><span data-line="25"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unknown error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">description</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="26"><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="27"><span class="w">    </span><span class="p">}</span>
</span><span data-line="28"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-3-error-information">
<h3>Pattern 3: Error Information<a class="headerlink" href="#pattern-3-error-information" title="Link to this heading">¶</a></h3>
<p><strong>Error class methods:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">Error</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="k">public</span><span class="o">:</span>
</span><span data-line="3"><span class="w">    </span><span class="n">ErrorCode</span><span class="w"> </span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">           </span><span class="c1">// Get error code enum</span>
</span><span data-line="4"><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">message</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// Get error message</span>
</span><span data-line="5"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">description</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">  </span><span class="c1">// Full description</span>
</span><span data-line="6"><span class="p">};</span>
</span></pre></div>
</div>
<p><strong>Example usage:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Focus</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_error</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">();</span>
</span><span data-line="5"><span class="w">    </span>
</span><span data-line="6"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error code: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">err</span><span class="p">.</span><span class="n">code</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="7"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Message: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span data-line="8"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Description: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">description</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="9"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-4-default-values">
<h3>Pattern 4: Default Values<a class="headerlink" href="#pattern-4-default-values" title="Link to this heading">¶</a></h3>
<p><strong>Provide fallback on error:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Get brightness or default to 0</span>
</span><span data-line="2"><span class="n">PropSetting</span><span class="w"> </span><span class="n">brightness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">).</span><span class="n">value_or</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// Get range or default range</span>
</span><span data-line="5"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">).</span><span class="n">value_or</span><span class="p">(</span><span class="n">PropRange</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-5-early-return">
<h3>Pattern 5: Early Return<a class="headerlink" href="#pattern-5-early-return" title="Link to this heading">¶</a></h3>
<p><strong>Simplify error propagation:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Result</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">configure_camera</span><span class="p">(</span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">exp_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-7</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="3"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">exp_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">exp_result</span><span class="p">;</span><span class="w">  </span><span class="c1">// Propagate error</span>
</span><span data-line="5"><span class="w">    </span><span class="p">}</span>
</span><span data-line="6"><span class="w">    </span>
</span><span data-line="7"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">bright_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="8"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bright_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bright_result</span><span class="p">;</span>
</span><span data-line="10"><span class="w">    </span><span class="p">}</span>
</span><span data-line="11"><span class="w">    </span>
</span><span data-line="12"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Ok</span><span class="p">();</span><span class="w">  </span><span class="c1">// Success</span>
</span><span data-line="13"><span class="p">}</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1">// Usage</span>
</span><span data-line="16"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configure_camera</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span><span data-line="17"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="18"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Configuration failed: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="19"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-6-retry-logic">
<h3>Pattern 6: Retry Logic<a class="headerlink" href="#pattern-6-retry-logic" title="Link to this heading">¶</a></h3>
<p><strong>Handle transient errors:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Func</span><span class="o">&gt;</span>
</span><span data-line="2"><span class="k">auto</span><span class="w"> </span><span class="n">retry_on_busy</span><span class="p">(</span><span class="n">Func</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max_retries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delay_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_retries</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">attempt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">();</span>
</span><span data-line="5"><span class="w">        </span>
</span><span data-line="6"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span data-line="8"><span class="w">        </span><span class="p">}</span>
</span><span data-line="9"><span class="w">        </span>
</span><span data-line="10"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">DeviceBusy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="11"><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="n">delay_ms</span><span class="p">));</span>
</span><span data-line="12"><span class="w">            </span><span class="k">continue</span><span class="p">;</span>
</span><span data-line="13"><span class="w">        </span><span class="p">}</span>
</span><span data-line="14"><span class="w">        </span>
</span><span data-line="15"><span class="w">        </span><span class="c1">// Non-retryable error</span>
</span><span data-line="16"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span data-line="17"><span class="w">    </span><span class="p">}</span>
</span><span data-line="18"><span class="w">    </span>
</span><span data-line="19"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">func</span><span class="p">();</span><span class="w">  </span><span class="c1">// Final attempt</span>
</span><span data-line="20"><span class="p">}</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1">// Usage</span>
</span><span data-line="23"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retry_on_busy</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="24"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-6</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="25"><span class="p">});</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-7-hresult-decoding">
<h3>Pattern 7: HRESULT Decoding<a class="headerlink" href="#pattern-7-hresult-decoding" title="Link to this heading">¶</a></h3>
<p><strong>Get detailed DirectShow errors:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;duvc-ctl/util/error_decoder.h&gt;</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_error</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">SystemError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="c1">// SystemError indicates DirectShow/COM failure</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;DirectShow error occurred</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="8"><span class="w">    </span>
</span><span data-line="9"><span class="w">    </span><span class="c1">// Get diagnostic info</span>
</span><span data-line="10"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">get_diagnostic_info</span><span class="p">();</span>
</span><span data-line="11"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Diagnostics:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="12"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>HRESULT helpers:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Decode HRESULT to human-readable string</span>
</span><span data-line="2"><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">decode_hresult</span><span class="p">(</span><span class="n">HRESULT</span><span class="w"> </span><span class="n">hr</span><span class="p">);</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// Get detailed error info (facility, code, etc.)</span>
</span><span data-line="5"><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">get_hresult_details</span><span class="p">(</span><span class="n">HRESULT</span><span class="w"> </span><span class="n">hr</span><span class="p">);</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// Check error categories</span>
</span><span data-line="8"><span class="kt">bool</span><span class="w"> </span><span class="nf">is_device_error</span><span class="p">(</span><span class="n">HRESULT</span><span class="w"> </span><span class="n">hr</span><span class="p">);</span>
</span><span data-line="9"><span class="kt">bool</span><span class="w"> </span><span class="nf">is_permission_error</span><span class="p">(</span><span class="n">HRESULT</span><span class="w"> </span><span class="n">hr</span><span class="p">);</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-8-validation-before-operations">
<h3>Pattern 8: Validation Before Operations<a class="headerlink" href="#pattern-8-validation-before-operations" title="Link to this heading">¶</a></h3>
<p><strong>Prevent errors proactively:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Validate camera is accessible</span>
</span><span data-line="2"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">camera</span><span class="p">.</span><span class="n">is_valid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera not valid</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="4"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="5"><span class="p">}</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// Validate property is supported</span>
</span><span data-line="8"><span class="k">auto</span><span class="w"> </span><span class="n">range_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="9"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Exposure not supported by this camera</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="11"><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span data-line="12"><span class="p">}</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1">// Validate value is in range</span>
</span><span data-line="15"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range_result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="16"><span class="kt">int</span><span class="w"> </span><span class="n">user_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-5</span><span class="p">;</span>
</span><span data-line="17">
</span><span data-line="18"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range</span><span class="p">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">user_value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="19"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Value &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">user_value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; out of range [&quot;</span>
</span><span data-line="20"><span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="21"><span class="w">    </span><span class="n">user_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">user_value</span><span class="p">);</span>
</span><span data-line="22"><span class="p">}</span>
</span><span data-line="23">
</span><span data-line="24"><span class="c1">// Now safe to set</span>
</span><span data-line="25"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">user_value</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-9-logging-and-diagnostics">
<h3>Pattern 9: Logging and Diagnostics<a class="headerlink" href="#pattern-9-logging-and-diagnostics" title="Link to this heading">¶</a></h3>
<p><strong>Comprehensive error logging:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kt">void</span><span class="w"> </span><span class="nf">log_error</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">Error</span><span class="o">&amp;</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;camera_errors.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
</span><span data-line="3"><span class="w">    </span>
</span><span data-line="4"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span data-line="5"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">to_time_t</span><span class="p">(</span><span class="n">now</span><span class="p">);</span>
</span><span data-line="6"><span class="w">    </span>
</span><span data-line="7"><span class="w">    </span><span class="n">log</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">time</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] &quot;</span>
</span><span data-line="8"><span class="w">        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ErrorCode: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">code</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span>
</span><span data-line="9"><span class="w">        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Message: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="10"><span class="p">}</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1">// Usage</span>
</span><span data-line="13"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="14"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="15"><span class="w">    </span><span class="n">log_error</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">());</span>
</span><span data-line="16"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>System diagnostics:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Get platform/driver info for troubleshooting</span>
</span><span data-line="2"><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">get_diagnostic_info</span><span class="p">();</span>
</span><span data-line="3"><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;System info:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-10-exception-free-api">
<h3>Pattern 10: Exception-Free API<a class="headerlink" href="#pattern-10-exception-free-api" title="Link to this heading">¶</a></h3>
<p><strong>No exceptions thrown by library:</strong></p>
<p>All errors are returned via <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code>. Only exception is <code class="docutils literal notranslate"><span class="pre">std::bad_variant_access</span></code> if calling <code class="docutils literal notranslate"><span class="pre">.value()</span></code> on error result.</p>
<p><strong>Safe value access:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// BAD: May throw std::bad_variant_access</span>
</span><span data-line="2"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// GOOD: Check before accessing</span>
</span><span data-line="5"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="6"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="8"><span class="p">}</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1">// GOOD: Use value_or</span>
</span><span data-line="11"><span class="n">PropSetting</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value_or</span><span class="p">({</span><span class="mi">-6</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-11-graceful-degradation">
<h3>Pattern 11: Graceful Degradation<a class="headerlink" href="#pattern-11-graceful-degradation" title="Link to this heading">¶</a></h3>
<p><strong>Fall back to supported properties:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Try to enable auto-focus, fall back to manual if unsupported</span>
</span><span data-line="2"><span class="k">auto</span><span class="w"> </span><span class="n">focus_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Focus</span><span class="p">);</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">focus_range</span><span class="p">.</span><span class="n">is_ok</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">focus_range</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">default_mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Focus</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">focus_range</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">default_val</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Auto</span><span class="p">});</span>
</span><span data-line="6"><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="c1">// Auto-focus not supported, set manual focus to middle of range</span>
</span><span data-line="8"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">focus_range</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">focus_range</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">focus_range</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span data-line="10"><span class="w">        </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Focus</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="11"><span class="w">    </span><span class="p">}</span>
</span><span data-line="12"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-12-bulk-error-handling">
<h3>Pattern 12: Bulk Error Handling<a class="headerlink" href="#pattern-12-bulk-error-handling" title="Link to this heading">¶</a></h3>
<p><strong>Aggregate errors from multiple operations:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">struct</span><span class="w"> </span><span class="nc">ConfigError</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">property</span><span class="p">;</span>
</span><span data-line="3"><span class="w">    </span><span class="n">duvc</span><span class="o">::</span><span class="n">Error</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><span data-line="4"><span class="p">};</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ConfigError</span><span class="o">&gt;</span><span class="w"> </span><span class="n">apply_config</span><span class="p">(</span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Config</span><span class="o">&amp;</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ConfigError</span><span class="o">&gt;</span><span class="w"> </span><span class="n">errors</span><span class="p">;</span>
</span><span data-line="8"><span class="w">    </span>
</span><span data-line="9"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">exp_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">exposure</span><span class="p">);</span>
</span><span data-line="10"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">exp_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="11"><span class="w">        </span><span class="n">errors</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="s">&quot;Exposure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">exp_result</span><span class="p">.</span><span class="n">error</span><span class="p">()});</span>
</span><span data-line="12"><span class="w">    </span><span class="p">}</span>
</span><span data-line="13"><span class="w">    </span>
</span><span data-line="14"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">bright_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">brightness</span><span class="p">);</span>
</span><span data-line="15"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bright_result</span><span class="p">.</span><span class="n">is_ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="16"><span class="w">        </span><span class="n">errors</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="s">&quot;Brightness&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bright_result</span><span class="p">.</span><span class="n">error</span><span class="p">()});</span>
</span><span data-line="17"><span class="w">    </span><span class="p">}</span>
</span><span data-line="18"><span class="w">    </span>
</span><span data-line="19"><span class="w">    </span><span class="c1">// Continue with other properties...</span>
</span><span data-line="20"><span class="w">    </span>
</span><span data-line="21"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">errors</span><span class="p">;</span>
</span><span data-line="22"><span class="p">}</span>
</span><span data-line="23">
</span><span data-line="24"><span class="c1">// Usage</span>
</span><span data-line="25"><span class="k">auto</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_config</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">);</span>
</span><span data-line="26"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">errors</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="27"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">errors</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; configuration errors:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="28"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">errors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="29"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">property</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="30"><span class="w">    </span><span class="p">}</span>
</span><span data-line="31"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="common-error-scenarios">
<h3>Common Error Scenarios<a class="headerlink" href="#common-error-scenarios" title="Link to this heading">¶</a></h3>
<p><strong>Device disconnected mid-operation:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">DeviceNotFound</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="c1">// Re-enumerate devices</span>
</span><span data-line="5"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="6"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">devices</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">        </span><span class="n">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Camera</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="8"><span class="w">    </span><span class="p">}</span>
</span><span data-line="9"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Property not supported:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Pan</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">PropertyNotSupported</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Pan not supported by this camera</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="5"><span class="w">    </span><span class="c1">// Try alternative property or skip</span>
</span><span data-line="6"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Camera in use:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">DeviceBusy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Camera in use - close other applications (Skype, Teams, OBS)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="5"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Invalid value:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">InvalidValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="c1">// Query valid range</span>
</span><span data-line="5"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="6"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Valid range: [&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">min</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">max</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="7"><span class="w">    </span>
</span><span data-line="8"><span class="w">    </span><span class="c1">// Clamp and retry</span>
</span><span data-line="9"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">clamped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">9999</span><span class="p">);</span>
</span><span data-line="10"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">clamped</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="11"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>System error (DirectShow failure):</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">code</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ErrorCode</span><span class="o">::</span><span class="n">SystemError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;DirectShow error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">().</span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="3"><span class="w">    </span>
</span><span data-line="4"><span class="w">    </span><span class="c1">// Get detailed diagnostics</span>
</span><span data-line="5"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">get_diagnostic_info</span><span class="p">();</span>
</span><span data-line="6"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Diagnostics:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span data-line="7"><span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="thread-safety-guidelines">
<h2>8.4 Thread Safety Guidelines<a class="headerlink" href="#thread-safety-guidelines" title="Link to this heading">¶</a></h2>
<p><strong>Critical COM Limitation:</strong> <code class="docutils literal notranslate"><span class="pre">duvc-ctl</span></code> uses DirectShow COM interfaces that are <strong>bound to the thread that creates them</strong>. COM objects cannot be accessed from any thread other than the one that initialized them.</p>
<hr class="docutils" />
<section id="com-threading-model">
<h3>COM Threading Model<a class="headerlink" href="#com-threading-model" title="Link to this heading">¶</a></h3>
<p><strong>DirectShow apartment threading:</strong></p>
<p>Each <code class="docutils literal notranslate"><span class="pre">Camera</span></code> or <code class="docutils literal notranslate"><span class="pre">DeviceConnection</span></code> initializes a COM apartment on the thread that constructs it. All subsequent operations on that object <strong>must</strong> occur on the same thread.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// CORRECT: Camera used on creating thread</span>
</span><span data-line="2"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM initialized on this thread</span>
</span><span data-line="3"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span><span class="w">  </span><span class="c1">// Same thread - OK</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1">// WRONG: Camera accessed from different thread</span>
</span><span data-line="6"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM initialized on main thread</span>
</span><span data-line="7"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t</span><span class="p">([</span><span class="o">&amp;</span><span class="n">camera</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="8"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span><span class="w">  </span><span class="c1">// CRASH! Wrong thread</span>
</span><span data-line="9"><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Why this crashes:</strong> DirectShow COM interfaces are <strong>single-threaded apartment (STA)</strong> objects. Calling methods from a different thread violates COM apartment rules and results in undefined behavior, crashes, or <code class="docutils literal notranslate"><span class="pre">RPC_E_WRONG_THREAD</span></code> errors.</p>
</section>
<hr class="docutils" />
<section id="rule-1-thread-affinity">
<h3>Rule 1: Thread Affinity<a class="headerlink" href="#rule-1-thread-affinity" title="Link to this heading">¶</a></h3>
<p><strong>Each Camera is bound to its creating thread:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Thread 1 creates camera</span>
</span><span data-line="2"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// Thread 2 tries to use it - WILL FAIL</span>
</span><span data-line="5"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t</span><span class="p">([</span><span class="o">&amp;</span><span class="n">camera</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM violation!</span>
</span><span data-line="7"><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Solution:</strong> Create separate <code class="docutils literal notranslate"><span class="pre">Camera</span></code> instances per thread:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t1</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM initialized for thread 1</span>
</span><span data-line="3"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="4"><span class="p">});</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t2</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="7"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Separate COM context for thread 2</span>
</span><span data-line="8"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">VidProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="9"><span class="p">});</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="rule-2-no-moving-between-threads">
<h3>Rule 2: No Moving Between Threads<a class="headerlink" href="#rule-2-no-moving-between-threads" title="Link to this heading">¶</a></h3>
<p><strong>Camera objects cannot be moved between threads:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Created on main thread</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// WRONG: Attempting to transfer ownership</span>
</span><span data-line="4"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t</span><span class="p">([</span><span class="n">camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">camera</span><span class="p">)]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span><span class="w">  </span><span class="c1">// Still bound to main thread COM!</span>
</span><span data-line="6"><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Explanation:</strong> Moving a <code class="docutils literal notranslate"><span class="pre">Camera</span></code> object transfers its member data, but the underlying COM interfaces remain bound to the original thread’s apartment. Accessing them from another thread violates COM rules.</p>
</section>
<hr class="docutils" />
<section id="pattern-1-thread-local-cameras">
<h3>Pattern 1: Thread-Local Cameras<a class="headerlink" href="#pattern-1-thread-local-cameras" title="Link to this heading">¶</a></h3>
<p><strong>Safe:</strong> Each thread creates and owns its camera:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kt">void</span><span class="w"> </span><span class="nf">camera_worker</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">device_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="n">device_index</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM initialized here</span>
</span><span data-line="3"><span class="w">    </span>
</span><span data-line="4"><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">        </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="6"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</span><span data-line="7"><span class="w">    </span><span class="p">}</span>
</span><span data-line="8"><span class="w">    </span><span class="c1">// camera destroyed, COM cleaned up</span>
</span><span data-line="9"><span class="p">}</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t1</span><span class="p">(</span><span class="n">camera_worker</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="12"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t2</span><span class="p">(</span><span class="n">camera_worker</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-2-message-queue-recommended">
<h3>Pattern 2: Message Queue (Recommended)<a class="headerlink" href="#pattern-2-message-queue-recommended" title="Link to this heading">¶</a></h3>
<p><strong>Dispatch commands to dedicated camera thread:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">class</span><span class="w"> </span><span class="nc">CameraWorker</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="k">public</span><span class="o">:</span>
</span><span data-line="3"><span class="w">    </span><span class="n">CameraWorker</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">device_index</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">running_</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">        </span><span class="c1">// Create camera on worker thread</span>
</span><span data-line="5"><span class="w">        </span><span class="n">thread_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">device_index</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">            </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">device_index</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM bound to this thread</span>
</span><span data-line="7"><span class="w">            </span>
</span><span data-line="8"><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
</span><span data-line="10"><span class="w">                </span><span class="n">cv_</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">queue_</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">running_</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
</span><span data-line="11"><span class="w">                </span>
</span><span data-line="12"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">running_</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span data-line="13"><span class="w">                </span>
</span><span data-line="14"><span class="w">                </span><span class="k">auto</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queue_</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
</span><span data-line="15"><span class="w">                </span><span class="n">queue_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
</span><span data-line="16"><span class="w">                </span><span class="n">lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
</span><span data-line="17"><span class="w">                </span>
</span><span data-line="18"><span class="w">                </span><span class="c1">// Execute on camera&#39;s thread</span>
</span><span data-line="19"><span class="w">                </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">cmd</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="20"><span class="w">            </span><span class="p">}</span>
</span><span data-line="21"><span class="w">        </span><span class="p">});</span>
</span><span data-line="22"><span class="w">    </span><span class="p">}</span>
</span><span data-line="23"><span class="w">    </span>
</span><span data-line="24"><span class="w">    </span><span class="o">~</span><span class="n">CameraWorker</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="25"><span class="w">        </span><span class="n">running_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span data-line="26"><span class="w">        </span><span class="n">cv_</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
</span><span data-line="27"><span class="w">        </span><span class="n">thread_</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
</span><span data-line="28"><span class="w">    </span><span class="p">}</span>
</span><span data-line="29"><span class="w">    </span>
</span><span data-line="30"><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">set_exposure</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="31"><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
</span><span data-line="32"><span class="w">        </span><span class="n">queue_</span><span class="p">.</span><span class="n">push</span><span class="p">({</span><span class="n">value</span><span class="p">});</span>
</span><span data-line="33"><span class="w">        </span><span class="n">cv_</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
</span><span data-line="34"><span class="w">    </span><span class="p">}</span>
</span><span data-line="35"><span class="w">    </span>
</span><span data-line="36"><span class="k">private</span><span class="o">:</span>
</span><span data-line="37"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">thread_</span><span class="p">;</span>
</span><span data-line="38"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queue_</span><span class="p">;</span>
</span><span data-line="39"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span>
</span><span data-line="40"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">cv_</span><span class="p">;</span>
</span><span data-line="41"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">running_</span><span class="p">;</span>
</span><span data-line="42"><span class="p">};</span>
</span><span data-line="43">
</span><span data-line="44"><span class="c1">// Usage - thread-safe</span>
</span><span data-line="45"><span class="n">CameraWorker</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="46"><span class="n">worker</span><span class="p">.</span><span class="n">set_exposure</span><span class="p">(</span><span class="mi">-7</span><span class="p">);</span><span class="w">  </span><span class="c1">// Called from any thread</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-3-mutex-limitation">
<h3>Pattern 3: Mutex Limitation<a class="headerlink" href="#pattern-3-mutex-limitation" title="Link to this heading">¶</a></h3>
<p><strong>Mutex protects against concurrent access, but does NOT solve COM threading:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Created on main thread</span>
</span><span data-line="2"><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// WRONG: Mutex doesn&#39;t fix COM threading</span>
</span><span data-line="5"><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="nf">t</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
</span><span data-line="7"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span><span class="w">  </span><span class="c1">// Still COM violation!</span>
</span><span data-line="8"><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Mutex is only useful</strong> when multiple code paths on the <strong>same thread</strong> need to access the camera:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="2"><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1">// Both on main thread - mutex prevents races</span>
</span><span data-line="5"><span class="kt">void</span><span class="w"> </span><span class="nf">callback1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
</span><span data-line="7"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="8"><span class="p">}</span>
</span><span data-line="9">
</span><span data-line="10"><span class="kt">void</span><span class="w"> </span><span class="nf">callback2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="11"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
</span><span data-line="12"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="13"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="global-functions-thread-safety">
<h3>Global Functions Thread Safety<a class="headerlink" href="#global-functions-thread-safety" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Function</p></th>
<th class="head text-left"><p>Thread-Safe?</p></th>
<th class="head text-left"><p>COM Restriction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">list_devices()</span></code></p></td>
<td class="text-left"><p>Yes</p></td>
<td class="text-left"><p>Creates temporary COM context per call</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">is_device_connected()</span></code></p></td>
<td class="text-left"><p>Yes</p></td>
<td class="text-left"><p>Creates temporary COM context per call</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">register_device_change_callback()</span></code></p></td>
<td class="text-left"><p><strong>No</strong></p></td>
<td class="text-left"><p>Must call from main thread</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Camera</span></code> object</p></td>
<td class="text-left"><p><strong>No</strong></p></td>
<td class="text-left"><p>Bound to creating thread</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">DeviceConnection</span></code></p></td>
<td class="text-left"><p><strong>No</strong></p></td>
<td class="text-left"><p>Bound to creating thread</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Hot-plug callbacks:</strong></p>
<p>Callbacks are invoked on Windows message pump thread. Dispatch heavy work to worker threads:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">duvc</span><span class="o">::</span><span class="n">register_device_change_callback</span><span class="p">([](</span><span class="kt">bool</span><span class="w"> </span><span class="n">added</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="c1">// Running on Windows message thread!</span>
</span><span data-line="3"><span class="w">    </span>
</span><span data-line="4"><span class="w">    </span><span class="c1">// WRONG: Create camera here</span>
</span><span data-line="5"><span class="w">    </span><span class="c1">// Camera camera(devices);  // COM on message thread</span>
</span><span data-line="6"><span class="w">    </span>
</span><span data-line="7"><span class="w">    </span><span class="c1">// CORRECT: Dispatch to worker</span>
</span><span data-line="8"><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">async</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">launch</span><span class="o">::</span><span class="n">async</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">added</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="10"><span class="w">        </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM on async thread</span>
</span><span data-line="11"><span class="w">    </span><span class="p">});</span>
</span><span data-line="12"><span class="p">});</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="summary-com-threading-rules">
<h3>Summary: COM Threading Rules<a class="headerlink" href="#summary-com-threading-rules" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Thread affinity:</strong> Each <code class="docutils literal notranslate"><span class="pre">Camera</span></code> must be used only on its creating thread</p></li>
<li><p><strong>No transfer:</strong> Cannot move/pass <code class="docutils literal notranslate"><span class="pre">Camera</span></code> objects between threads</p></li>
<li><p><strong>Per-thread instances:</strong> Create separate <code class="docutils literal notranslate"><span class="pre">Camera</span></code> instances in each thread</p></li>
<li><p><strong>Message passing:</strong> Use message queues to communicate with camera threads</p></li>
<li><p><strong>Mutex limitation:</strong> Mutex does NOT solve COM threading violations</p></li>
</ol>
<p><strong>Violation symptoms:</strong> Access violations, <code class="docutils literal notranslate"><span class="pre">E_FAIL</span></code> errors, crashes, <code class="docutils literal notranslate"><span class="pre">RPC_E_WRONG_THREAD</span></code> errors.</p>
</section>
</section>
<hr class="docutils" />
<section id="performance-optimization">
<h2>8.5 Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading">¶</a></h2>
<p><strong>Goal:</strong> Minimize overhead while respecting COM threading constraints.</p>
<hr class="docutils" />
<section id="core-optimization-principles">
<h3>Core Optimization Principles<a class="headerlink" href="#core-optimization-principles" title="Link to this heading">¶</a></h3>
<p><strong>Expensive operations:</strong></p>
<ul class="simple">
<li><p><strong>Device enumeration</strong> (<code class="docutils literal notranslate"><span class="pre">list_devices()</span></code>) - USB bus scanning + DirectShow binding</p></li>
<li><p><strong>Camera construction</strong> - COM initialization + DirectShow graph setup</p></li>
<li><p><strong>Property operations</strong> (<code class="docutils literal notranslate"><span class="pre">get()</span></code>/<code class="docutils literal notranslate"><span class="pre">set()</span></code>) - DirectShow interface calls</p></li>
<li><p><strong>Range queries</strong> (<code class="docutils literal notranslate"><span class="pre">get_range()</span></code>) - DirectShow capability queries</p></li>
</ul>
<p><strong>Inexpensive operations:</strong></p>
<ul class="simple">
<li><p>Result type checking (<code class="docutils literal notranslate"><span class="pre">is_ok()</span></code>, <code class="docutils literal notranslate"><span class="pre">is_error()</span></code>)</p></li>
<li><p>Value validation (<code class="docutils literal notranslate"><span class="pre">is_valid()</span></code>, <code class="docutils literal notranslate"><span class="pre">clamp()</span></code>)</p></li>
<li><p>Device struct copies</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pattern-1-cache-device-enumeration">
<h3>Pattern 1: Cache Device Enumeration<a class="headerlink" href="#pattern-1-cache-device-enumeration" title="Link to this heading">¶</a></h3>
<p><strong>Problem:</strong> Repeated enumeration is expensive:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// SLOW: Enumerate every iteration</span>
</span><span data-line="2"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span><span class="w">  </span><span class="c1">// Expensive USB scan</span>
</span><span data-line="4"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="5"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="6"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Solution:</strong> Enumerate once, reuse:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// FAST: One-time enumeration</span>
</span><span data-line="2"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="3"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="6"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="7"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Benefit:</strong> Eliminates repeated USB bus scanning overhead.</p>
</section>
<hr class="docutils" />
<section id="pattern-2-reuse-camera-objects">
<h3>Pattern 2: Reuse Camera Objects<a class="headerlink" href="#pattern-2-reuse-camera-objects" title="Link to this heading">¶</a></h3>
<p><strong>Problem:</strong> Construction overhead:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// SLOW: Recreate camera every iteration</span>
</span><span data-line="2"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM init + DirectShow binding</span>
</span><span data-line="4"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="5"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Solution:</strong> Create once:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// FAST: Reuse camera object</span>
</span><span data-line="2"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="3"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="5"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Benefit:</strong> Amortizes COM initialization and DirectShow graph setup.</p>
</section>
<hr class="docutils" />
<section id="pattern-3-batch-property-changes">
<h3>Pattern 3: Batch Property Changes<a class="headerlink" href="#pattern-3-batch-property-changes" title="Link to this heading">¶</a></h3>
<p><strong>Minimize DirectShow round-trips:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// SLOW: Unnecessary repeated sets</span>
</span><span data-line="2"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="4"><span class="w">    </span><span class="n">capture_frame</span><span class="p">();</span>
</span><span data-line="5"><span class="p">}</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// FAST: Set once</span>
</span><span data-line="8"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="9"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="n">capture_frame</span><span class="p">();</span>
</span><span data-line="11"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-4-cache-property-ranges">
<h3>Pattern 4: Cache Property Ranges<a class="headerlink" href="#pattern-4-cache-property-ranges" title="Link to this heading">¶</a></h3>
<p><strong>Query capabilities once:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// SLOW: Query every iteration</span>
</span><span data-line="2"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-10</span><span class="p">;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="3"><span class="w">    </span><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="4"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">        </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="6"><span class="w">    </span><span class="p">}</span>
</span><span data-line="7"><span class="p">}</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1">// FAST: Cache range</span>
</span><span data-line="10"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="11"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-10</span><span class="p">;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="12"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="13"><span class="w">        </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="14"><span class="w">    </span><span class="p">}</span>
</span><span data-line="15"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-5-low-level-deviceconnection">
<h3>Pattern 5: Low-Level DeviceConnection<a class="headerlink" href="#pattern-5-low-level-deviceconnection" title="Link to this heading">¶</a></h3>
<p><strong>Bypass Result<T> for hot loops:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Normal API: Result wrapper overhead</span>
</span><span data-line="2"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span data-line="3"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="5"><span class="p">}</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// Low-level API: Direct boolean return</span>
</span><span data-line="8"><span class="n">duvc</span><span class="o">::</span><span class="n">DeviceConnection</span><span class="w"> </span><span class="n">conn</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</span><span data-line="9"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="10"><span class="w">    </span><span class="n">conn</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span><span class="w">  </span><span class="c1">// Returns bool</span>
</span><span data-line="11"><span class="p">}</span>
</span></pre></div>
</div>
<p><strong>Trade-off:</strong> Faster in tight loops, but less error information and throws on construction failure.</p>
</section>
<hr class="docutils" />
<section id="pattern-6-parallel-multi-camera-setup">
<h3>Pattern 6: Parallel Multi-Camera Setup<a class="headerlink" href="#pattern-6-parallel-multi-camera-setup" title="Link to this heading">¶</a></h3>
<p><strong>Configure cameras concurrently:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">auto</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duvc</span><span class="o">::</span><span class="n">list_devices</span><span class="p">();</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// Serial: Process cameras sequentially</span>
</span><span data-line="4"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="5"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</span><span data-line="6"><span class="w">    </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="7"><span class="p">}</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1">// Parallel: Process cameras concurrently</span>
</span><span data-line="10"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">futures</span><span class="p">;</span>
</span><span data-line="11"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="12"><span class="w">    </span><span class="n">futures</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">async</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">launch</span><span class="o">::</span><span class="n">async</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">device</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="13"><span class="w">        </span><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="n">device</span><span class="p">);</span><span class="w">  </span><span class="c1">// COM on this thread</span>
</span><span data-line="14"><span class="w">        </span><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="15"><span class="w">    </span><span class="p">}));</span>
</span><span data-line="16"><span class="p">}</span>
</span><span data-line="17"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">futures</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</span></pre></div>
</div>
<p><strong>Benefit:</strong> Near-linear speedup with number of cameras (assuming independent USB controllers).</p>
</section>
<hr class="docutils" />
<section id="pattern-7-lazy-connection">
<h3>Pattern 7: Lazy Connection<a class="headerlink" href="#pattern-7-lazy-connection" title="Link to this heading">¶</a></h3>
<p><strong>First operation triggers connection:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Camera</span><span class="w"> </span><span class="nf">camera</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// Fast: No COM connection yet</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1">// Connection created on first use</span>
</span><span data-line="4"><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">);</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1">// Subsequent calls reuse connection</span>
</span><span data-line="7"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Brightness</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span></pre></div>
</div>
<p><strong>Optimization:</strong> Perform initialization operations during application startup, not in performance-critical paths.</p>
</section>
<hr class="docutils" />
<section id="pattern-8-avoid-validation-overhead">
<h3>Pattern 8: Avoid Validation Overhead<a class="headerlink" href="#pattern-8-avoid-validation-overhead" title="Link to this heading">¶</a></h3>
<p><strong>Skip validation for known-good values:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Safe: Validate user input</span>
</span><span data-line="2"><span class="n">PropRange</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">get_range</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">).</span><span class="n">value</span><span class="p">();</span>
</span><span data-line="3"><span class="kt">int</span><span class="w"> </span><span class="n">safe_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">user_input</span><span class="p">);</span>
</span><span data-line="4"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">safe_value</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1">// Fast: Skip validation for constants</span>
</span><span data-line="7"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Zoom</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span><span class="w">  </span><span class="c1">// Known valid</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-9-minimize-data-copies">
<h3>Pattern 9: Minimize Data Copies<a class="headerlink" href="#pattern-9-minimize-data-copies" title="Link to this heading">¶</a></h3>
<p><strong>Pass by reference, use move semantics:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// SLOW: Copy device structs</span>
</span><span data-line="2"><span class="kt">void</span><span class="w"> </span><span class="nf">configure_camera</span><span class="p">(</span><span class="n">Device</span><span class="w"> </span><span class="n">device</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Copies struct</span>
</span><span data-line="3"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</span><span data-line="4"><span class="p">}</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1">// FAST: Pass by const reference</span>
</span><span data-line="7"><span class="kt">void</span><span class="w"> </span><span class="nf">configure_camera</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Device</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="8"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</span><span data-line="9"><span class="p">}</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1">// FAST: Move when transferring ownership</span>
</span><span data-line="12"><span class="kt">void</span><span class="w"> </span><span class="nf">configure_camera</span><span class="p">(</span><span class="n">Device</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">device</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="13"><span class="w">    </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">device</span><span class="p">));</span>
</span><span data-line="14"><span class="p">}</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="pattern-10-profile-before-optimizing">
<h3>Pattern 10: Profile Before Optimizing<a class="headerlink" href="#pattern-10-profile-before-optimizing" title="Link to this heading">¶</a></h3>
<p><strong>Identify actual bottlenecks:</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">// Use profiling tools to identify hotspots:</span>
</span><span data-line="2"><span class="c1">// - Visual Studio Profiler (Windows)</span>
</span><span data-line="3"><span class="c1">// - gprof (Linux)</span>
</span><span data-line="4"><span class="c1">// - Valgrind (Linux)</span>
</span><span data-line="5"><span class="c1">// - perf (Linux)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1">// Measure specific operations:</span>
</span><span data-line="8"><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span data-line="9"><span class="n">camera</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">CamProp</span><span class="o">::</span><span class="n">Exposure</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">CamMode</span><span class="o">::</span><span class="n">Manual</span><span class="p">});</span>
</span><span data-line="10"><span class="k">auto</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span data-line="11"><span class="k">auto</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
</span><span data-line="12"><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Operation took &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">duration</span><span class="p">.</span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; µs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="optimization-priority">
<h3>Optimization Priority<a class="headerlink" href="#optimization-priority" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Cache</strong> <code class="docutils literal notranslate"><span class="pre">list_devices()</span></code> result - Eliminates repeated USB enumeration</p></li>
<li><p><strong>Reuse</strong> <code class="docutils literal notranslate"><span class="pre">Camera</span></code> objects - Amortizes COM/DirectShow initialization</p></li>
<li><p><strong>Batch</strong> property changes - Reduces DirectShow interface calls</p></li>
<li><p><strong>Cache</strong> property ranges - Avoids repeated capability queries</p></li>
<li><p><strong>Parallelize</strong> multi-camera operations - Leverages concurrent hardware access</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">DeviceConnection</span></code> for hot loops - Reduces wrapper overhead</p></li>
<li><p><strong>Profile</strong> to find real bottlenecks - Don’t optimize prematurely</p></li>
</ol>
<p><strong>Key insight:</strong> Most performance gains come from reducing the <strong>number</strong> of expensive operations (enumeration, construction) rather than optimizing individual operations.</p>
</section>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="07_property-reference-details.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">7. Property Reference &amp; Details</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="09_build-system-integration.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">9. Build System &amp; Integration</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, allanhanan</p>
  
  <p>
    Made with
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/allanhanan/duvc-ctl" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=51b770b3"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=5375a926"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../../_static/shibuya.js?v=c1cf1a6b"></script></body>
</html>